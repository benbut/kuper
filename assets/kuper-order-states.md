# –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π –∑–∞–∫–∞–∑–∞ –≤ Push-–º–æ–¥–µ–ª–∏ –ö—É–ø–µ—Ä API

## –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –ö—É–ø–µ—Ä–∞

```mermaid
stateDiagram-v2
    [*] --> ready : –ö–ª–∏–µ–Ω—Ç –æ—Ñ–æ—Ä–º–∏–ª –∑–∞–∫–∞–∑
    ready --> collecting : order.in_work –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞
    ready --> canceled : order.canceled / timeout
    
    collecting --> assembled : order.assembled –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞
    collecting --> canceled : order.canceled
    
    assembled --> ready_to_ship : order.ready_for_delivery –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞ + —Å–ø–∏—Å–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
    assembled --> canceled : order.canceled
    
    ready_to_ship --> shipping : –ö—É—Ä—å–µ—Ä –∑–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑ (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ö—É–ø–µ—Ä–∞)
    ready_to_ship --> shipped : order.delivered –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞ (—Å–∞–º–æ–≤—ã–≤–æ–∑/–¥–æ—Å—Ç–∞–≤–∫–∞ –º–µ—Ä—á–∞–Ω—Ç–∞)
    ready_to_ship --> canceled : order.canceled
    
    shipping --> shipped : order.delivered –æ—Ç –ö—É–ø–µ—Ä–∞ (–¥–æ—Å—Ç–∞–≤–∫–∞ –ö—É–ø–µ—Ä–∞)
    shipping --> canceled : order.canceled (–¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏)
    
    shipped --> [*]
    canceled --> [*]
    
    note right of ready
        –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã: not_paid
        –†–µ–∑–µ—Ä–≤ —Å—É–º–º—ã –Ω–∞ —Å—á–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞
    end note
    
    note right of ready_to_ship
        –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã: paid
        –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–∞
    end note
    
    note right of shipping
        –¢–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏ –ö—É–ø–µ—Ä–∞:
        order.received ‚Üí order.delivering
    end note
```

## –°–æ—Å—Ç–æ—è–Ω–∏—è –æ–ø–ª–∞—Ç—ã

```mermaid
stateDiagram-v2
    [*] --> not_paid : –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω
    not_paid --> paid : –ü–æ—Å–ª–µ order.ready_for_delivery
    paid --> [*] : –ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω/–æ—Ç–º–µ–Ω–µ–Ω
    
    note right of not_paid
        –°—É–º–º–∞ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∞
        –Ω–∞ —Å—á–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞
    end note
    
    note right of paid
        –§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—É–º–º–∞ —Å–ø–∏—Å–∞–Ω–∞
        –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ –∑–∞–∫–∞–∑–∞
    end note
```

## –î–µ—Ç–∞–ª—å–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø–æ —Ç–∏–ø–∞–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –î–ª—è —Ç–∏–ø–∞ "–°–±–æ—Ä–∫–∞ –º–µ—Ä—á–∞–Ω—Ç–∞, –¥–æ—Å—Ç–∞–≤–∫–∞ –ö—É–ø–µ—Ä–∞"

```mermaid
timeline
    title –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Å–æ–±—ã—Ç–∏–π –∑–∞–∫–∞–∑–∞ (–¥–æ—Å—Ç–∞–≤–∫–∞ –ö—É–ø–µ—Ä–∞)
    
    section –°–æ–∑–¥–∞–Ω–∏–µ
        –ö–ª–∏–µ–Ω—Ç –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –∑–∞–∫–∞–∑ : –ó–∞–∫–∞–∑ –≤ –ö—É–ø–µ—Ä–µ (—Å—Ç–∞—Ç—É—Å: ready)
        order.created webhook : –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ—Ä—á–∞–Ω—Ç—É
        Response —Å ID –º–µ—Ä—á–∞–Ω—Ç–∞ : –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞
        
    section –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞  
        order.accepted (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) : –î–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
        order.in_work notification : –ù–∞—á–∞–ª–æ —Å–±–æ—Ä–∫–∏ (—Å—Ç–∞—Ç—É—Å: collecting)
        courier.assigned webhook : –ö—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        courier.arrived webhook : –ö—É—Ä—å–µ—Ä –ø—Ä–∏–±—ã–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        
    section –°–±–æ—Ä–∫–∞
        order.assembled notification : –ó–∞–∫–∞–∑ —Å–æ–±—Ä–∞–Ω (—Å—Ç–∞—Ç—É—Å: assembled)
        order.ready_for_delivery : –ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ + —Å–æ—Å—Ç–∞–≤ (—Å—Ç–∞—Ç—É—Å: ready_to_ship)
        order.paid webhook : –û–ø–ª–∞—Ç–∞ —Å–ø–∏—Å–∞–Ω–∞ (–æ–ø–ª–∞—Ç–∞: paid)
        
    section –î–æ—Å—Ç–∞–≤–∫–∞
        order.received webhook : –ö—É—Ä—å–µ—Ä –∑–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑ (—Å—Ç–∞—Ç—É—Å: shipping)
        order.delivering webhook : –î–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å
        order.delivered webhook : –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω (—Å—Ç–∞—Ç—É—Å: shipped)
```

### –î–ª—è —Ç–∏–ø–∞ "–°–±–æ—Ä–∫–∞ –º–µ—Ä—á–∞–Ω—Ç–∞, —Å–∞–º–æ–≤—ã–≤–æ–∑"

```mermaid
timeline
    title –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Å–æ–±—ã—Ç–∏–π –∑–∞–∫–∞–∑–∞ (—Å–∞–º–æ–≤—ã–≤–æ–∑)
    
    section –°–æ–∑–¥–∞–Ω–∏–µ
        –ö–ª–∏–µ–Ω—Ç –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –∑–∞–∫–∞–∑ : –ó–∞–∫–∞–∑ –≤ –ö—É–ø–µ—Ä–µ (—Å—Ç–∞—Ç—É—Å: ready)
        order.created webhook : –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ—Ä—á–∞–Ω—Ç—É
        Response —Å ID –º–µ—Ä—á–∞–Ω—Ç–∞ : –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞
        
    section –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞  
        order.accepted (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) : –î–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
        order.in_work notification : –ù–∞—á–∞–ª–æ —Å–±–æ—Ä–∫–∏ (—Å—Ç–∞—Ç—É—Å: collecting)
        
    section –°–±–æ—Ä–∫–∞
        order.assembled notification : –ó–∞–∫–∞–∑ —Å–æ–±—Ä–∞–Ω (—Å—Ç–∞—Ç—É—Å: assembled)
        order.ready_for_delivery : –ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ + —Å–æ—Å—Ç–∞–≤ (—Å—Ç–∞—Ç—É—Å: ready_to_ship)
        order.pickup_code_created : –ö–æ–¥ –≤—ã–¥–∞—á–∏ —Å–æ–∑–¥–∞–Ω
        order.paid webhook : –û–ø–ª–∞—Ç–∞ —Å–ø–∏—Å–∞–Ω–∞ (–æ–ø–ª–∞—Ç–∞: paid)
        
    section –í—ã–¥–∞—á–∞
        –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –∑–∞ –∑–∞–∫–∞–∑–æ–º : –ö–ª–∏–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–¥
        order.delivered –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞ : –ó–∞–∫–∞–∑ –≤—ã–¥–∞–Ω + —Å–æ—Å—Ç–∞–≤ (—Å—Ç–∞—Ç—É—Å: shipped)
```

### –î–ª—è —Ç–∏–ø–∞ "–°–±–æ—Ä–∫–∞ –º–µ—Ä—á–∞–Ω—Ç–∞, –¥–æ—Å—Ç–∞–≤–∫–∞ –º–µ—Ä—á–∞–Ω—Ç–∞"

```mermaid
timeline
    title –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Å–æ–±—ã—Ç–∏–π –∑–∞–∫–∞–∑–∞ (–¥–æ—Å—Ç–∞–≤–∫–∞ –º–µ—Ä—á–∞–Ω—Ç–∞)
    
    section –°–æ–∑–¥–∞–Ω–∏–µ
        –ö–ª–∏–µ–Ω—Ç –æ—Ñ–æ—Ä–º–ª—è–µ—Ç –∑–∞–∫–∞–∑ : –ó–∞–∫–∞–∑ –≤ –ö—É–ø–µ—Ä–µ (—Å—Ç–∞—Ç—É—Å: ready)
        order.created webhook : –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ—Ä—á–∞–Ω—Ç—É
        Response —Å ID –º–µ—Ä—á–∞–Ω—Ç–∞ : –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞
        
    section –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞  
        order.accepted (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) : –î–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤
        order.in_work notification : –ù–∞—á–∞–ª–æ —Å–±–æ—Ä–∫–∏ (—Å—Ç–∞—Ç—É—Å: collecting)
        
    section –°–±–æ—Ä–∫–∞
        order.assembled notification : –ó–∞–∫–∞–∑ —Å–æ–±—Ä–∞–Ω (—Å—Ç–∞—Ç—É—Å: assembled)
        order.ready_for_delivery : –ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ + —Å–æ—Å—Ç–∞–≤ (—Å—Ç–∞—Ç—É—Å: ready_to_ship)
        order.paid webhook : –û–ø–ª–∞—Ç–∞ —Å–ø–∏—Å–∞–Ω–∞ (–æ–ø–ª–∞—Ç–∞: paid)
        
    section –î–æ—Å—Ç–∞–≤–∫–∞
        order.estimated_delivery_time : –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞
        order.delivering : –î–æ—Å—Ç–∞–≤–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å (—Å—Ç–∞—Ç—É—Å: shipping)
        order.delivered –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞ : –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω + —Å–æ—Å—Ç–∞–≤ (—Å—Ç–∞—Ç—É—Å: shipped)
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –æ—Ç–º–µ–Ω

```mermaid
flowchart TD
    A[–õ—é–±–æ–π —ç—Ç–∞–ø –ø—Ä–æ—Ü–µ—Å—Å–∞] --> B{–û—à–∏–±–∫–∞/–æ—Ç–º–µ–Ω–∞?}
    B -->|–û—Ç–º–µ–Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–º| C[–ö—É–ø–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç order.canceled]
    B -->|–û—Ç–º–µ–Ω–∞ –ö—É–ø–µ—Ä–æ–º| D[–ö—É–ø–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç order.canceled]  
    B -->|–û—Ç–º–µ–Ω–∞ –º–µ—Ä—á–∞–Ω—Ç–æ–º| E[–ú–µ—Ä—á–∞–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç order.canceled]
    B -->|–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã| F[–ú–µ—Ä—á–∞–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç order.canceled]
    B -->|–¢–∞–π–º–∞—É—Ç order.accepted| G[–ö—É–ø–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑]
    
    C --> H[–°—Ç–∞—Ç—É—Å: canceled]
    D --> H
    E --> H
    F --> H
    G --> H
    
    H --> I{–ï—Å—Ç—å —Ä–µ–∑–µ—Ä–≤ —Å—Ä–µ–¥—Å—Ç–≤?}
    I -->|–î–∞| J[–í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∫–ª–∏–µ–Ω—Ç—É]
    I -->|–ù–µ—Ç| K[–ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω]
    J --> K
    
    style C fill:#ffcdd2
    style D fill:#ffcdd2  
    style E fill:#ffcdd2
    style F fill:#ffcdd2
    style G fill:#ffcdd2
    style H fill:#ffcdd2
```

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –≤ —Å—Ç–∞—Ç—É—Å–∞—Ö

```mermaid
flowchart LR
    subgraph "–î–æ—Å—Ç–∞–≤–∫–∞ –ö—É–ø–µ—Ä–∞"
        A1[ready_to_ship] --> B1[shipping] --> C1[shipped]
        B1 -.-> D1[order.received<br/>order.delivering<br/>order.delivered]
    end
    
    subgraph "–°–∞–º–æ–≤—ã–≤–æ–∑"
        A2[ready_to_ship] --> C2[shipped]
        A2 -.-> D2[order.pickup_code_created<br/>order.delivered –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞]
    end
    
    subgraph "–î–æ—Å—Ç–∞–≤–∫–∞ –º–µ—Ä—á–∞–Ω—Ç–∞"
        A3[ready_to_ship] --> B3[shipping] --> C3[shipped]
        B3 -.-> D3[order.estimated_delivery_time<br/>order.delivering<br/>order.delivered –æ—Ç –º–µ—Ä—á–∞–Ω—Ç–∞]
    end
    
    style A1 fill:#e8f5e8
    style A2 fill:#e3f2fd
    style A3 fill:#fff3e0
    style B1 fill:#e8f5e8
    style B3 fill:#fff3e0
    style C1 fill:#c8e6c9
    style C2 fill:#c8e6c9
    style C3 fill:#c8e6c9
```

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–º–µ–Ω—Ç—ã

### ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

1. **order.created**: –í—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞—Ç—å —É—Å–ø–µ—à–Ω–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–∫–∞–∑ –Ω–µ–ª—å–∑—è –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
2. **order.ready_for_delivery**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π —Å–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞
3. **–û—Ç–º–µ–Ω—ã**: –£–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∏—á–∏–Ω—É –≤ –ø–æ–ª–µ `cancellation`
4. **–¢–∞–π–º–∞—É—Ç—ã**: –ö—É–ø–µ—Ä –æ—Ç–º–µ–Ω—è–µ—Ç –∑–∞–∫–∞–∑ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ `order.accepted` –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤)
5. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤—Ö–æ–¥—è—â–∏—Ö –≤–µ–±—Ö—É–∫–æ–≤
6. **–ü–æ—Ä—è–¥–æ–∫ —Å–æ–±—ã—Ç–∏–π**: –°–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### üìã –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –æ—Ç–≤–µ—Ç–æ–≤

**order.created response:**
```json
{
  "status": "created",
  "number": "ID_–∑–∞–∫–∞–∑–∞_–≤_—Å–∏—Å—Ç–µ–º–µ_–º–µ—Ä—á–∞–Ω—Ç–∞",
  "expectedAssemblyTime": "2021-05-24T13:45:00+03:00" // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

**order.ready_for_delivery notification:**
```json
{
  "event_type": "order.ready_for_delivery",
  "payload": {
    "orderUUID": "...",
    "number": "...",
    "positions": [...], // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –∏—Ç–æ–≥–æ–≤—ã–π —Å–æ—Å—Ç–∞–≤
    "total": {...}      // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞
  }
}
```

**order.delivered notification (–¥–ª—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞/–¥–æ—Å—Ç–∞–≤–∫–∏ –º–µ—Ä—á–∞–Ω—Ç–∞):**
```json
{
  "event_type": "order.delivered",
  "payload": {
    "orderUUID": "...",
    "number": "...",
    "positions": [...], // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –∏—Ç–æ–≥–æ–≤—ã–π —Å–æ—Å—Ç–∞–≤ –≤—ã–¥–∞–Ω–Ω–æ–≥–æ
    "total": {...}      // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û: –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ –≤—ã–¥–∞–Ω–Ω–æ–≥–æ
  }
}
```

**order.canceled notification:**
```json
{
  "event_type": "order.canceled",
  "payload": {
    "orderUUID": "...",
    "number": "...",
    "cancellation": {
      "slug": "reason_code",
      "description": "–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –æ—Ç–º–µ–Ω—ã"
    }
  }
}
``` 