# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –ö—É–ø–µ—Ä–∞ - –ö—É–ø–µ—Ä API

–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ç–∏–ø–∞ **"–°–±–æ—Ä–∫–∞ –º–µ—Ä—á–∞–Ω—Ç–∞, –¥–æ—Å—Ç–∞–≤–∫–∞ –ö—É–ø–µ—Ä–∞"** –¥–ª—è Push-–º–æ–¥–µ–ª–∏ –ö—É–ø–µ—Ä API.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

–ü—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –ö—É–ø–µ—Ä–∞:
- **–ú–µ—Ä—á–∞–Ω—Ç** —Å–æ–±–∏—Ä–∞–µ—Ç –∑–∞–∫–∞–∑ –≤ —Å–≤–æ–µ–º –º–∞–≥–∞–∑–∏–Ω–µ
- **–ö—É–ø–µ—Ä** –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –¥–æ—Å—Ç–∞–≤–∫—É —á–µ—Ä–µ–∑ —Å–≤–æ–∏—Ö –∫—É—Ä—å–µ—Ä–æ–≤
- **–ö—É–ø–µ—Ä** –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏ –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞
- **–ú–µ—Ä—á–∞–Ω—Ç** –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∫—É—Ä—å–µ—Ä–∞ –∏ –¥–æ—Å—Ç–∞–≤–∫–∏

## üì± –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

```mermaid
sequenceDiagram
    participant Client as –ö–ª–∏–µ–Ω—Ç
    participant Kuper as –ö—É–ø–µ—Ä API
    participant PharmAPI as API Ecom
    participant OneS as 1–° –†–æ–∑–Ω–∏—Ü–∞ (–ê–ø—Ç–µ–∫–∞)
    participant Pharmacist as –§–∞—Ä–º–∞—Ü–µ–≤—Ç
    participant Courier as –ö—É—Ä—å–µ—Ä
    
    Client->>Kuper: –ó–∞–∫–∞–∑ –ª–µ–∫–∞—Ä—Å—Ç–≤ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π
    
    Kuper->>PharmAPI: webhook: order.created
    
    %% –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤
    PharmAPI->>OneS: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—Ç–∞—Ç–∫–æ–≤ + —Å—Ä–æ–∫–∏ –≥–æ–¥–Ω–æ—Å—Ç–∏
    OneS->>PharmAPI: –û—Å—Ç–∞—Ç–∫–∏ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ —Å –≥–æ–¥–Ω–æ—Å—Ç—å—é
    
    alt –ü—Ä–µ–ø–∞—Ä–∞—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã
        PharmAPI->>OneS: –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ
        OneS->>PharmAPI: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–∞
        PharmAPI->>Kuper: response: status created, number PHARMACY_ORDER_ID
        
        Note over Pharmacist: –§–∞—Ä–º–∞—Ü–µ–≤—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–±–æ—Ä–∫—É
        Pharmacist->>OneS: –§–∞—Ä–º–∞—Ü–µ–≤—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–±–æ—Ä–∫—É
        OneS->>PharmAPI: notification: order.going_to
        PharmAPI->>Kuper: notification: order.in_work
        Note over Kuper: –ù–∞—á–∏–Ω–∞–µ—Ç –ø–æ–∏—Å–∫ –∫—É—Ä—å–µ—Ä–∞
        
        opt –ö—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω
            Kuper->>PharmAPI: webhook: courier.assigned + –¥–∞–Ω–Ω—ã–µ –∫—É—Ä—å–µ—Ä–∞
        end
        
        %% –°–±–æ—Ä–∫–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤
        loop –°–±–æ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞
            Pharmacist->>OneS: –°–±–æ—Ä–∫–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–∞ –ø–æ —Å–µ—Ä–∏–∏
        end
        
        OneS->>PharmAPI: –î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω + –∏—Ç–æ–≥–æ–≤—ã–π —Å–æ—Å—Ç–∞–≤
        PharmAPI->>Kuper: notification: order.ready_for_delivery + –∏—Ç–æ–≥–æ–≤—ã–π —Å–æ—Å—Ç–∞–≤
        
        Note over Kuper: –°–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Å—É–º–º—É —Å–æ —Å—á–µ—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞
        
        Kuper->>PharmAPI: webhook: order.paid
        Note over PharmAPI: –ü–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã

        opt –ö—É—Ä—å–µ—Ä –ø—Ä–∏–±—ã–ª –≤ –∞–ø—Ç–µ–∫—É
            Kuper->>PharmAPI: webhook: courier.arrived
        end
        
        %% –ü–µ—Ä–µ–¥–∞—á–∞ –∫—É—Ä—å–µ—Ä—É
        Pharmacist->>Courier: –ü–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ–≤ –∫—É—Ä—å–µ—Ä—É
        Kuper->>PharmAPI: webhook: order.received
        
        Kuper->>PharmAPI: webhook: order.delivering
        Note over Courier: –ö—É—Ä—å–µ—Ä –¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞–∫–∞–∑
        
        Kuper->>PharmAPI: webhook: order.delivered
        Note over Client: –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É
        
    else –ü—Ä–µ–ø–∞—Ä–∞—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã
        PharmAPI->>Kuper: response: status created, number PHARMACY_ORDER_ID
        PharmAPI->>Kuper: notification: order.canceled + –ø—Ä–∏—á–∏–Ω–∞
        Note over Kuper: –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∫–ª–∏–µ–Ω—Ç—É
    end
    
    opt –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ
        alt –û—Ç–º–µ–Ω–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ö—É–ø–µ—Ä–∞/–∫–ª–∏–µ–Ω—Ç–∞
            Kuper->>PharmAPI: webhook: order.canceled + –ø—Ä–∏—á–∏–Ω–∞
            PharmAPI->>OneS: –°–Ω—è—Ç–∏–µ —Ä–µ–∑–µ—Ä–≤–∞/–≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–æ–≤
        else –û—Ç–º–µ–Ω–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –º–µ—Ä—á–∞–Ω—Ç–∞
            PharmAPI->>Kuper: notification: order.canceled + –ø—Ä–∏—á–∏–Ω–∞
            PharmAPI->>OneS: –°–Ω—è—Ç–∏–µ —Ä–µ–∑–µ—Ä–≤–∞/–≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–æ–≤
        end
        Note over Kuper: –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∫–ª–∏–µ–Ω—Ç—É
    end
```

## üéØ –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Å–æ–±—ã—Ç–∏–π

```mermaid
timeline
    title –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–∫–∞–∑–∞ —Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –ö—É–ø–µ—Ä–∞
    
    section –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ
        –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω : –ö–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª –¥–æ—Å—Ç–∞–≤–∫—É
                     : order.created ‚Üí response
        –ü—Ä–∏–Ω—è—Ç–∏–µ : order.accepted (–¥–ª—è —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤)
                 : –ó–∞–∫–∞–∑ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ –º–µ—Ä—á–∞–Ω—Ç–∞
        
    section –ü–æ–∏—Å–∫ –∫—É—Ä—å–µ—Ä–∞ –∏ —Å–±–æ—Ä–∫–∞
        –ù–∞—á–∞–ª–æ —Å–±–æ—Ä–∫–∏ : order.in_work
                     : –ö—É–ø–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç –ø–æ–∏—Å–∫ –∫—É—Ä—å–µ—Ä–∞
                     : –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞: collecting
        –ö—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–µ–Ω : courier.assigned (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                       : –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫—É—Ä—å–µ—Ä–µ
        –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ : –ú–µ—Ä—á–∞–Ω—Ç —Å–æ–±–∏—Ä–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏
                      : –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Å–æ—Å—Ç–∞–≤–∞ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        
    section –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∏ –æ–ø–ª–∞—Ç–∞
        –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å : order.ready_for_delivery + –∏—Ç–æ–≥–æ–≤—ã–π —Å–æ—Å—Ç–∞–≤
                   : –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞: ready_to_ship
        –°–ø–∏—Å–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã : –ö—É–ø–µ—Ä —Å–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫—É—é —Å—É–º–º—É
                       : –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã: paid
        –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã : order.paid (webhook)
                            : –î–µ–Ω—å–≥–∏ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã –∑–∞ –∑–∞–∫–∞–∑–æ–º
        –ö—É—Ä—å–µ—Ä –ø—Ä–∏–±—ã–ª : courier.arrived (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                     : –ö—É—Ä—å–µ—Ä –≥–æ—Ç–æ–≤ –∑–∞–±—Ä–∞—Ç—å –∑–∞–∫–∞–∑
        
    section –ó–∞–±–æ—Ä –∏ –¥–æ—Å—Ç–∞–≤–∫–∞
        –ó–∞–±–æ—Ä –∑–∞–∫–∞–∑–∞ : order.received
                    : –ö—É—Ä—å–µ—Ä –∑–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑ —É –º–µ—Ä—á–∞–Ω—Ç–∞
                    : –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞: shipping
        –î–æ—Å—Ç–∞–≤–∫–∞ : order.delivering
                 : –ö—É—Ä—å–µ—Ä –µ–¥–µ—Ç –∫ –∫–ª–∏–µ–Ω—Ç—É
        –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ : order.delivered
                  : –ó–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω –∫–ª–∏–µ–Ω—Ç—É
                  : –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞: shipped
```

## üìã –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –ö—É–ø–µ—Ä–∞

### ‚úÖ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π —Å–ª—É–∂–±—ã:

1. **courier.assigned** - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫—É—Ä—å–µ—Ä–∞
   - –ü—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ `order.in_work`, –¥–æ `order.paid`
   - –°–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫—É—Ä—å–µ—Ä–µ (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω, –≤–æ–∑–º–æ–∂–Ω–æ —Ñ–æ—Ç–æ)
   - –ú–æ–∂–µ—Ç –Ω–µ –ø—Ä–∏–π—Ç–∏, –µ—Å–ª–∏ –∫—É—Ä—å–µ—Ä –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç

2. **courier.arrived** - –ü—Ä–∏–±—ã—Ç–∏–µ –∫—É—Ä—å–µ—Ä–∞
   - –ü—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ `courier.assigned`, –¥–æ `order.paid`
   - –û–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫—É—Ä—å–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –º–∞–≥–∞–∑–∏–Ω–µ –∏ –≥–æ—Ç–æ–≤ –∑–∞–±—Ä–∞—Ç—å –∑–∞–∫–∞–∑
   - –ü–æ–º–æ–≥–∞–µ—Ç –º–µ—Ä—á–∞–Ω—Ç—É –ø–æ–Ω—è—Ç—å, —á—Ç–æ –Ω—É–∂–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É

3. **order.received** - –ó–∞–±–æ—Ä –∑–∞–∫–∞–∑–∞
   - –ü—Ä–∏—Ö–æ–¥–∏—Ç —Å—Ç—Ä–æ–≥–æ –ø–æ—Å–ª–µ `order.paid`
   - –û–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫—É—Ä—å–µ—Ä –∑–∞–±—Ä–∞–ª –∑–∞–∫–∞–∑ –∏ –ø–æ–∫–∏–Ω—É–ª –º–∞–≥–∞–∑–∏–Ω
   - –° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –∑–∞–∫–∞–∑ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —É –∫—É—Ä—å–µ—Ä–∞

4. **order.delivering** - –ü—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏
   - –ö—É—Ä—å–µ—Ä –µ–¥–µ—Ç –∫ –∫–ª–∏–µ–Ω—Ç—É
   - –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∫—É—Ä—å–µ—Ä–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

5. **order.delivered** - –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏
   - –ö—É—Ä—å–µ—Ä –¥–æ—Å—Ç–∞–≤–∏–ª –∑–∞–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç—É
   - –ó–∞–∫–∞–∑ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω

### üöö –õ–æ–≥–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- –ö—É–ø–µ—Ä —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∫—É—Ä—å–µ—Ä–∞–º–∏
- –ú–µ—Ä—á–∞–Ω—Ç –Ω–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–æ—Å—Ç–∞–≤–∫–∏
- –í—Å–µ –≤–µ–±—Ö—É–∫–∏ –æ –¥–æ—Å—Ç–∞–≤–∫–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –æ—Ç –ö—É–ø–µ—Ä–∞
- –í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫—É—Ä—å–µ—Ä—Å–∫–æ–π —Å–ª—É–∂–±—ã

### üì¶ –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–¥–∞—á–∏ –∑–∞–∫–∞–∑–∞ –∫—É—Ä—å–µ—Ä—É:

1. –ö—É—Ä—å–µ—Ä –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ –º–∞–≥–∞–∑–∏–Ω (–º–æ–∂–µ—Ç –ø—Ä–∏–π—Ç–∏ `courier.arrived`)
2. –ú–µ—Ä—á–∞–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–±–æ—Ä–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `order.ready_for_delivery`
3. –ö—É–ø–µ—Ä —Å–ø–∏—Å—ã–≤–∞–µ—Ç –æ–ø–ª–∞—Ç—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `order.paid`
4. –ö—É—Ä—å–µ—Ä –∑–∞–±–∏—Ä–∞–µ—Ç –∑–∞–∫–∞–∑ (–ø—Ä–∏—Ö–æ–¥–∏—Ç `order.received`)
5. –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –¥–æ—Å—Ç–∞–≤–∫–∞ (–ø—Ä–∏—Ö–æ–¥–∏—Ç `order.delivering`)
